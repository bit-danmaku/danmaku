version: "3.7"
services:
  api-gateway:
    image: fkynjyq/bit-danmaku_api-gateway
    ports:
      - 8008:8080

  danmaku-cache:
    image: fkynjyq/bit-danmaku_danmaku-cache
  
  kafka-producer:
    image: fkynjyq/bit-danmaku_kafka-producer
    environment:
      - MICRO_BROKER=kafka
      - MICRO_BROKER_ADDRESS=kafka:9092

  mariadb:
    image: mariadb
    restart: always
    ports:
      - 3306:3306
    volumes:
      - mariadb-data:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: qwerty
    #command: "mysqld --init-file /data/application/init.sql"
    #volumes:
    #- ./init.sql:/data/application/init.sql
    # hello

  phpmyadmin:
    image: phpmyadmin/phpmyadmin:latest
    ports:
      - 7999:80
    environment:
      - PMA_ARBITRARY=1
      - PMA_HOST=mariadb
    depends_on:
      - mariadb

  redis:
    image: redis
    ports:
      - 6379:6379

  redis-commander:
    image: rediscommander/redis-commander
    environment:
      - REDIS_HOSTS=local:redis:6379
    ports:
      - 7998:8081

  zookeeper:
    image: wurstmeister/zookeeper
  
  kafka:
    image: wurstmeister/kafka:latest
    environment:
      - KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181
      - KAFKA_ADVERTISED_HOST_NAME=127.0.0.1
      - KAFKA_ADVERTISED_PORT=9092

volumes:
  mariadb-data:
